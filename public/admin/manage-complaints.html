<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Complaints</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>
    
    <div class="admin-container">
        <!-- Sidebar Placeholder (Corrected ID) -->
        <div id="sidebar-container"></div>
        
        <main class="admin-main">
            <header class="page-header">
                <h1><i class="fas fa-list-alt"></i> Manage Complaints</h1>
                <p>View, filter, and manage all submitted complaints.</p>
            </header>

            <section class="filter-section card">
                <h2>Filter Complaints</h2>
                <div class="filter-controls-grid">
                    <div class="form-group">
                        <label for="status-filter">Status:</label>
                        <select id="status-filter" class="form-control">
                            <option value="all">All</option>
                            <option value="Pending">Pending</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Resolved">Resolved</option>
                            <option value="Closed">Closed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority-filter">Priority:</label>
                        <select id="priority-filter" class="form-control">
                            <option value="all">All</option>
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button id="apply-complaint-filters" class="btn btn-primary"><i class="fas fa-filter"></i> Apply Filters</button>
                        <button id="clear-complaint-filters" class="btn btn-outline"><i class="fas fa-times"></i> Clear Filters</button>
                    </div>
                </div>
            </section>

            <section class="complaints-list-section card">
                <h2>All Complaints</h2>
                <div class="table-responsive">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Submitted By</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="complaints-table-body">
                            <tr><td colspan="7" class="loading-text">Loading complaints...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="complaints-pagination-container" class="pagination-controls">
                    <!-- Pagination buttons will be loaded here by JS -->
                </div>
            </section>
        </main>
    </div>
    
    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- Complaint Details Modal -->
    <div id="complaintDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modal-complaint-title">Complaint Details</h2>
            <div class="modal-body">
                <p><strong>Complaint ID:</strong> <span id="modal-complaint-id"></span></p>
                <p><strong>Submitted By:</strong> <span id="modal-submitted-by"></span></p>
                <p><strong>Date Filed:</strong> <span id="modal-date-filed"></span></p>
                <p><strong>Description:</strong> <span id="modal-description"></span></p>
                <p><strong>Location:</strong> <span id="modal-location"></span></p>
                <p><strong>Current Status:</strong> <span id="modal-current-status" class="status-badge"></span></p>
                <p><strong>Priority:</strong> <span id="modal-priority" class="status-badge"></span></p>
                
                <div class="form-group">
                    <label for="modal-status-select">Update Status:</label>
                    <select id="modal-status-select" class="form-control">
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                        <option value="Closed">Closed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-priority-select">Update Priority:</label>
                    <select id="modal-priority-select" class="form-control">
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>
                <button id="save-status-btn" class="btn btn-primary btn-small">Save Changes</button>
                <div id="modal-message" class="auth-message" style="margin-top: 1rem;"></div>

                <h3>Evidence Files:</h3>
                <div id="modal-evidence-files">
                    <p>No evidence files provided.</p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/shared.js" type="module"></script>
    <script src="js/admin.js" type="module"></script>
    <script type="module">
        import { loadHeader, loadSidebar, loadFooter } from '/admin/js/shared.js';
        import { loadComplaints } from '/admin/js/admin.js'; 

        document.addEventListener('DOMContentLoaded', () => {
            loadHeader();
            loadSidebar();
            loadFooter();
            loadComplaints(); // Load complaints when the page loads

            // Event listeners for filters
            const applyFiltersBtn = document.getElementById('apply-complaint-filters');
            const clearFiltersBtn = document.getElementById('clear-complaint-filters');
            const statusFilter = document.getElementById('status-filter');
            const priorityFilter = document.getElementById('priority-filter');

            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', () => {
                    loadComplaints(1, statusFilter.value, priorityFilter.value);
                });
            }

            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', () => {
                    statusFilter.value = 'all';
                    priorityFilter.value = 'all';
                    loadComplaints(); // Reload with no filters
                });
            }
        });
    </script>
</body>
</html>
